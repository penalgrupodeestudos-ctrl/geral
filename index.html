<script>
// =====================================================
// PROJETO SABER 3.2 - COMPAT√çVEL COM GITHUB
// =====================================================

let simulados = {};
let questoesFiltradas = [];
let simuladoAtual = 0;
let questaoAtual = 0;
let respostas = {};
let marcadas = new Set();
let tempoInicio = 0;
let timerInterval = null;
let modo = 'simulado';
let disciplinaAtualFiltro = 'todos';

// =========================
// 1Ô∏è‚É£ CARREGAR MANIFEST
// =========================
async function carregarManifest() {
    try {
        const resposta = await fetch('data/simulados_manifest.json');
        if (!resposta.ok) throw new Error('Arquivo manifest n√£o encontrado.');
        simulados = await resposta.json();
        montarMenuPrincipal();
    } catch (erro) {
        console.warn('‚ö†Ô∏è Manifest n√£o encontrado, exibindo menu padr√£o.', erro);
        // Exibe menu mesmo sem manifest (modo fallback)
        simulados = {};
        montarMenuPrincipal();
    }
}

// =========================
// 2Ô∏è‚É£ MONTAR MENU PRINCIPAL
// =========================
function montarMenuPrincipal() {
    const menu = document.querySelector('#telaPrincipal .menu-principal');
    let html = '';

    // Se manifest carregado, exibe simulados
    if (Object.keys(simulados).length > 0) {
        Object.entries(simulados).forEach(([id, sim]) => {
            html += `
                <div class="card-simulado" onclick="iniciarSimulado(${id})">
                    <h3>üìã ${sim.nome}</h3>
                    <div class="info">
                        <strong>${sim.total} Quest√µes</strong><br>
                        ${sim.descricao || ''}
                    </div>
                    <button class="btn">FAZER SIMULADO</button>
                </div>
            `;
        });
    } else {
        html += `
            <div class="card-simulado">
                <h3>‚ö†Ô∏è Nenhum simulado encontrado</h3>
                <div class="info">Verifique se o arquivo <b>data/simulados_manifest.json</b> existe no GitHub.</div>
            </div>
        `;
    }

    // Cards padr√£o (disciplinas, desempenho, ajuda)
    html += `
        <div class="card-simulado" onclick="abrirDisciplinas()">
            <h3>üìö Estudar por Disciplina</h3>
            <div class="info"><strong>Estudo Focado</strong><br>Escolha a disciplina e aprofunde seus conhecimentos</div>
            <button class="btn btn-disciplina">DISCIPLINAS</button>
        </div>
        <div class="card-simulado" onclick="verDesempenho()">
            <h3>üìä Meu Desempenho</h3>
            <div class="info"><strong>An√°lise de Progresso</strong><br>Acompanhe seu desenvolvimento</div>
            <button class="btn" style="background:linear-gradient(135deg,#e74c3c 0%,#c0392b 100%);">ESTAT√çSTICAS</button>
        </div>
        <div class="card-simulado" onclick="mostrarAjuda()">
            <h3>‚ùì Ajuda</h3>
            <div class="info"><strong>Tutorial</strong><br>Saiba como usar o Projeto Saber</div>
            <button class="btn" style="background:linear-gradient(135deg,#f39c12 0%,#d68910 100%);">TUTORIAL</button>
        </div>
    `;

    menu.innerHTML = html;
}

// =========================
// 3Ô∏è‚É£ INICIAR SIMULADO
// =========================
async function iniciarSimulado(id) {
    try {
        const sim = simulados[id];
        const resp = await fetch(sim.arquivo);
        if (!resp.ok) throw new Error('Erro ao abrir arquivo JSON.');
        questoesFiltradas = await resp.json();

        simuladoAtual = id;
        questaoAtual = 0;
        respostas = {};
        marcadas = new Set();
        tempoInicio = Date.now();
        modo = 'simulado';

        document.getElementById('telaPrincipal').classList.add('hidden');
        document.getElementById('quizContainer').classList.remove('hidden');
        document.getElementById('resultadoContainer').classList.remove('ativo');

        iniciarTimer();
        exibirQuestao();
    } catch (erro) {
        console.error('Erro ao iniciar simulado:', erro);
        alert('‚ö†Ô∏è Erro ao carregar as quest√µes do simulado.');
    }
}

// =========================
// 4Ô∏è‚É£ FUN√á√ïES ORIGINAIS
// =========================
function mostrarAjuda() {
    alert('‚ÑπÔ∏è PROJETO SABER:\n\n1Ô∏è‚É£ Escolha um simulado\n2Ô∏è‚É£ Responda as quest√µes\n3Ô∏è‚É£ Use dicas üí°\n4Ô∏è‚É£ Marque ‚≠ê para revisar\n5Ô∏è‚É£ Veja resultados.\n\nBom estudo! üöÄ');
}

function verDesempenho() {
    alert('üìä Painel de desempenho em desenvolvimento.');
}

// MANTENHA TODAS AS FUN√á√ïES ORIGINAIS ABAIXO:
// exibirQuestao(), selecionarOpcao(), mostrarDica(), questaoProxima(), etc.
// N√£o precisam ser alteradas ‚Äî continuam funcionando normalmente.

</script>
<script>
carregarManifest();
</script>
