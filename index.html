<script>
// ==========================================
// VERS√ÉO 3.2 - LEITURA EXTERNA DE SIMULADOS
// ==========================================

let simulados = {};
let questoesFiltradas = [];
let simuladoAtual = 0;
let questaoAtual = 0;
let respostas = {};
let marcadas = new Set();
let tempoInicio = 0;
let timerInterval = null;
let modo = 'simulado';
let disciplinaAtualFiltro = 'todos';

// Carregar manifest JSON com os simulados
async function carregarManifest() {
    try {
        const resposta = await fetch('data/simulados_manifest.json');
        simulados = await resposta.json();
        montarMenuPrincipal();
    } catch (erro) {
        console.error('Erro ao carregar manifest:', erro);
        alert('Erro ao carregar os simulados. Verifique o arquivo /data/simulados_manifest.json');
    }
}

// Montar os cards dinamicamente a partir do manifest
function montarMenuPrincipal() {
    const menu = document.querySelector('#telaPrincipal .menu-principal');
    let html = '';

    Object.entries(simulados).forEach(([id, sim]) => {
        html += `
            <div class="card-simulado" onclick="iniciarSimulado(${id})">
                <h3>üìã ${sim.nome}</h3>
                <div class="info">
                    <strong>${sim.total} Quest√µes</strong><br>
                    ${sim.descricao || ''}
                </div>
                <button class="btn">FAZER SIMULADO</button>
            </div>
        `;
    });

    // Mant√©m os cards padr√£o (disciplinas, desempenho, ajuda)
    menu.innerHTML = html + `
        <div class="card-simulado" onclick="abrirDisciplinas()">
            <h3>üìö Estudar por Disciplina</h3>
            <div class="info"><strong>Estudo Focado</strong><br>Escolha a disciplina e aprofunde seus conhecimentos</div>
            <button class="btn btn-disciplina">DISCIPLINAS</button>
        </div>
        <div class="card-simulado" onclick="verDesempenho()">
            <h3>üìä Meu Desempenho</h3>
            <div class="info"><strong>An√°lise de Progresso</strong><br>Acompanhe seu desenvolvimento</div>
            <button class="btn" style="background:linear-gradient(135deg,#e74c3c 0%,#c0392b 100%);">ESTAT√çSTICAS</button>
        </div>
        <div class="card-simulado" onclick="mostrarAjuda()">
            <h3>‚ùì Ajuda</h3>
            <div class="info"><strong>Tutorial</strong><br>Saiba como usar o Projeto Saber</div>
            <button class="btn" style="background:linear-gradient(135deg,#f39c12 0%,#d68910 100%);">TUTORIAL</button>
        </div>
    `;
}

// Iniciar simulado selecionado
async function iniciarSimulado(num) {
    try {
        const sim = simulados[num];
        const resp = await fetch(sim.arquivo);
        questoesFiltradas = await resp.json();

        simuladoAtual = num;
        questaoAtual = 0;
        respostas = {};
        marcadas = new Set();
        tempoInicio = Date.now();
        modo = 'simulado';

        document.getElementById('telaPrincipal').classList.add('hidden');
        document.getElementById('quizContainer').classList.remove('hidden');
        document.getElementById('resultadoContainer').classList.remove('ativo');
        iniciarTimer();
        exibirQuestao();
    } catch (erro) {
        console.error('Erro ao iniciar simulado:', erro);
        alert('Erro ao carregar quest√µes do simulado.');
    }
}

// === As fun√ß√µes abaixo s√£o mantidas do seu c√≥digo original ===
// (exibirQuestao, selecionarOpcao, mostrarDica, navega√ß√£o, marcar, finalizarSimulado, etc.)
// Basta mant√™-las iguais ao seu arquivo atual ‚Äî nada muda nelas.

</script>
<script>
carregarManifest(); // inicializa ao abrir a p√°gina
</script>
