<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VERIFICAR DESEMPENHO DO ALUNO - Simulados Interativos</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        /* Variáveis de Tema (Design System Básico) */
        :root {
            --primary-color: #004d99; /* Azul Profundo */
            --secondary-color: #fca311; /* Laranja de Destaque */
            --success-color: #28a745; /* Verde para Acerto */
            --danger-color: #dc3545; /* Vermelho para Erro */
            --warning-color: #ffc107; /* Amarelo para Atenção */
            --bg-light: #f9fbfd; /* Fundo Leve */
            --bg-dark: #212529; /* Barra Lateral Escura */
            --text-dark: #343a40;
            --text-light: #fff;
            --border-color: #e9ecef;
            --card-bg: #ffffff;
        }

        /* Estilos Globais e Reset */
        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg-light);
            color: var(--text-dark);
            margin: 0;
            padding: 0;
            display: flex;
            min-height: 100vh;
        }

        /* Layout Principal */
        #sidebar {
            width: 300px;
            background-color: var(--bg-dark);
            color: var(--text-light);
            padding: 20px;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
            position: fixed;
            height: 100%;
            overflow-y: auto;
        }

        #main-content {
            margin-left: 300px;
            flex-grow: 1;
            padding: 20px;
        }

        /* Título e Navegação */
        h1 {
            font-family: 'Montserrat', sans-serif;
            color: var(--secondary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
            margin-top: 0;
            font-size: 1.5rem;
        }

        #quiz-list {
            list-style: none;
            padding: 0;
        }

        #quiz-list li {
            margin-bottom: 8px;
        }

        #quiz-list a {
            display: block;
            background-color: #343a40;
            color: var(--text-light);
            padding: 10px 15px;
            text-decoration: none;
            border-radius: 5px;
            transition: background-color 0.2s;
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            font-size: 0.9rem;
        }

        #quiz-list a:hover {
            background-color: var(--primary-color);
        }

        /* Questão Ativa */
        #quiz-container {
            max-width: 900px;
        }

        .question-card {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .question-card h3 {
            font-family: 'Montserrat', sans-serif;
            color: var(--primary-color);
            margin-top: 0;
            font-size: 1.2rem;
        }

        .question-card p {
            font-size: 1rem;
            line-height: 1.6;
        }

        .options label {
            display: block;
            padding: 10px;
            margin-bottom: 5px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
        }

        .options label:hover {
            background-color: #f1f1f1;
            border-color: var(--primary-color);
        }

        .options input[type="radio"] {
            margin-right: 10px;
            /* Esconde o radio padrão para estilizar melhor */
            display: none;
        }

        /* Estilo da Opção Selecionada/Correta/Incorreta */
        .options input[type="radio"]:checked + span {
            font-weight: bold;
            color: var(--primary-color);
        }

        .options label.correct {
            background-color: #d4edda; /* Verde Claro */
            border-color: var(--success-color);
            color: var(--success-color);
        }

        .options label.incorrect {
            background-color: #f8d7da; /* Vermelho Claro */
            border-color: var(--danger-color);
            color: var(--danger-color);
        }
        
        /* Estilo do Comentário */
        .comment {
            margin-top: 15px;
            padding: 10px;
            border-left: 5px solid var(--secondary-color);
            background-color: #fff3cd; /* Amarelo Claro - Atenção */
            color: var(--text-dark);
            border-radius: 0 5px 5px 0;
        }
        
        .comment h4 {
            color: var(--secondary-color);
            margin-top: 0;
            font-size: 1rem;
        }

        /* Botões */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            transition: opacity 0.2s;
            margin-right: 10px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: var(--text-light);
        }

        .btn-primary:hover {
            opacity: 0.9;
        }

        .btn-secondary {
            background-color: var(--secondary-color);
            color: var(--text-dark);
        }

        .btn-secondary:hover {
            opacity: 0.9;
        }

        /* Resultado */
        #results-container {
            margin-top: 20px;
            padding: 20px;
            border: 2px solid var(--primary-color);
            border-radius: 8px;
            background-color: var(--card-bg);
        }

        #results-container h2 {
            color: var(--primary-color);
        }

        .stat {
            font-size: 1.1rem;
            margin-bottom: 10px;
        }

        .stat-correct {
            color: var(--success-color);
        }

        .stat-incorrect {
            color: var(--danger-color);
        }

        /* Responsividade (Para telas menores que 768px) */
        @media (max-width: 768px) {
            body {
                flex-direction: column;
            }
            #sidebar {
                position: relative;
                width: 100%;
                height: auto;
            }
            #main-content {
                margin-left: 0;
                padding-top: 20px;
            }
        }
    </style>
</head>
<body>

    <div id="sidebar">
        <h1>Simulados</h1>
        <ul id="quiz-list">
            <li>Carregando simulados...</li>
        </ul>
        <hr style="border-color: #343a40; margin-top: 20px;">
        <h2>Pontuação</h2>
        <div id="current-score">
            <p>Acertos: <span id="correct-count">0</span></p>
            <p>Erros: <span id="incorrect-count">0</span></p>
            <p>Total: <span id="total-count">0</span></p>
        </div>
        <button id="show-results-btn" class="btn btn-secondary" style="margin-top: 10px; display: none;" onclick="showResults()">Ver Resultado Final</button>
    </div>

    <div id="main-content">
        <header>
            <h2 id="quiz-title">Selecione um Simulado ao Lado</h2>
            <p id="quiz-description">O menu à esquerda lista todos os simulados disponíveis. Clique em um para começar a responder.</p>
        </header>

        <div id="quiz-container">
            </div>

        <div id="navigation-buttons" style="margin-top: 20px; display: none;">
            <button id="prev-btn" class="btn btn-primary" onclick="changeQuestion(-1)">Questão Anterior</button>
            <button id="next-btn" class="btn btn-primary" onclick="changeQuestion(1)">Próxima Questão</button>
        </div>

        <div id="results-container" style="display: none;">
            </div>
    </div>

    <script>
        let currentQuizData = null;
        let userAnswers = {};
        let currentQuestionIndex = 0;
        let isSimuladoLoaded = false;
        
        /**
         * FUNÇÃO CORRIGIDA: Usa lista hardcoded para garantir o carregamento do menu.
         */
        async function loadSimulados() {
            const list = document.getElementById('quiz-list');
            list.innerHTML = ''; // Limpa a mensagem de carregamento

            // ** NOVO MANIFEST HARDCODED (Baseado no pedido do usuário) **
            const userSimulados = [
                "SIMULADO-DIREITOS-HUMANOS-JSON.json",
                "SIMULADO-IASES-JSON-COM-GABARITO.json",
                "SIMULADO-POLICIA-PENAL02.json",
                "SIMULADO-POLICIA-PENAL.json",
                "QUESTOES-GERAIS.json",
                "AREA-POLICIAL.json", // Se o seu arquivo for 'QUESTOES-AREA-POLICIAL.json', você precisa renomeá-lo para 'AREA-POLICIAL.json'
                "SIMULADO-IDCAP-60-QUESTOES.json",
                "SIMULADO-02-IDCAP-60-QUESTOES.json",
                "SIMULADO-03-IDCAP-60-QUESTOES.json", // Se o seu arquivo for '.txt', você precisa renomeá-lo para '.json'
                "ESTRATEGIA.json",
                "LEGISLAÇÃO-ESPECÍFICA.json"
            ];
            
            // Renderiza a lista de simulados
            userSimulados.forEach(filename => {
                // Limpa o nome do arquivo para um display amigável no menu
                let cleanName = filename.replace(/\.(json|txt)$/i, ''); 
                cleanName = cleanName.replace(/SIMULADO-|QUESTOES-|IDCAP-|COM-GABARITO|-JSON/g, '').trim();
                cleanName = cleanName.replace(/(\(|\))/g, '').trim(); 
                cleanName = cleanName.replace(/  /g, ' ').trim(); 

                const li = document.createElement('li');
                // Adiciona 'return false;' para prevenir navegação padrão do link, se houver.
                li.innerHTML = `<a href="#" onclick="loadAndRenderQuiz('${filename}'); return false;">${cleanName}</a>`;
                list.appendChild(li);
            });
            
            if (userSimulados.length === 0) {
                list.innerHTML = '<li>Nenhum arquivo de simulado encontrado.</li>';
            } else {
                 console.log("Lista de simulados carregada com sucesso a partir da lista fornecida pelo usuário.");
            }
        }
        // Fim da função corrigida

        async function loadAndRenderQuiz(filename) {
            document.getElementById('quiz-container').innerHTML = 'Carregando questões...';
            document.getElementById('results-container').style.display = 'none';
            document.getElementById('navigation-buttons').style.display = 'none';
            
            try {
                const response = await fetch(filename);
                if (!response.ok) {
                    throw new Error(`Não foi possível carregar o arquivo: ${filename}. Verifique se o nome do arquivo está correto na pasta.`);
                }
                const rawData = await response.json();
                
                // Normaliza a estrutura de dados (Alguns arquivos têm 'simulados_policia_penal', outros são um array direto)
                let data;
                if (Array.isArray(rawData)) {
                    // Assume que é um array de questões (como SIMULADO-IDCAP-60-QUESTOES.json)
                    data = { questoes: rawData, titulo: filename.replace('.json', '') };
                } else if (rawData.simulados_policia_penal && rawData.simulados_policia_penal.length > 0) {
                    // SIMULADO-02-IDCAP-60-QUESTOES.json
                    data = rawData.simulados_policia_penal[0];
                } else if (rawData.questoes) {
                     // ESTRATEGIA (1).json e outros
                    data = rawData;
                } else {
                    throw new Error("Estrutura do arquivo JSON de simulado desconhecida.");
                }

                currentQuizData = data;
                userAnswers = {};
                currentQuestionIndex = 0;
                isSimuladoLoaded = true;
                
                document.getElementById('quiz-title').textContent = data.nome || data.titulo || 'Simulado Carregado';
                document.getElementById('quiz-description').textContent = data.instrucoes || 'Responda as questões abaixo e verifique seu gabarito.';

                // Reinicia a contagem de score
                updateScoreDisplay(); 
                
                renderQuestion(currentQuestionIndex);
                document.getElementById('navigation-buttons').style.display = 'flex';
                document.getElementById('show-results-btn').style.display = 'block';

            } catch (error) {
                document.getElementById('quiz-container').innerHTML = `<p style="color: var(--danger-color);">Erro ao carregar o simulado: ${error.message}</p>`;
                console.error(error);
                isSimuladoLoaded = false;
            }
        }

        function renderQuestion(index) {
            if (!currentQuizData || !currentQuizData.questoes || index < 0 || index >= currentQuizData.questoes.length) {
                document.getElementById('quiz-container').innerHTML = '<p>Nenhuma questão para exibir.</p>';
                document.getElementById('navigation-buttons').style.display = 'none';
                return;
            }

            const question = currentQuizData.questoes[index];
            const container = document.getElementById('quiz-container');
            container.innerHTML = '';
            
            // Normaliza as chaves do objeto 'question'
            const questionText = question.questao || question.enunciado || question.pergunta || `Questão ${question.numero || index + 1}`;
            const questionNumber = question.numero || index + 1;
            const options = question.opcoes || question.alternativas;
            const correctAnswerKey = question.resposta_correta || question.resposta;
            const userAnswerKey = userAnswers[index];
            const explanation = question.explicacao_professor || question.comentario;

            // Cria o card da questão
            const card = document.createElement('div');
            card.className = 'question-card';

            // Título/Número
            card.innerHTML += `<h3>Questão ${questionNumber}</h3>`;

            // Enunciado
            card.innerHTML += `<p>${questionText}</p>`;
            
            // Adiciona texto base, se existir (útil para questões de interpretação)
            if (currentQuizData.texto_base && questionNumber === 1) {
                card.innerHTML = `<div style="border: 1px dashed #ccc; padding: 10px; margin-bottom: 15px; background-color: #f7f7f7;"><strong>TEXTO BASE:</strong><br>${currentQuizData.texto_base}</div>` + card.innerHTML;
            }

            // Opções
            const optionsDiv = document.createElement('div');
            optionsDiv.className = 'options';

            for (const key in options) {
                if (options.hasOwnProperty(key)) {
                    const optionText = options[key];
                    const radioId = `q${index}-${key}`;
                    
                    const label = document.createElement('label');
                    label.setAttribute('for', radioId);

                    const radio = document.createElement('input');
                    radio.type = 'radio';
                    radio.name = `question-${index}`;
                    radio.id = radioId;
                    radio.value = key;
                    radio.onchange = () => handleAnswer(index, key, correctAnswerKey);

                    // Verifica se esta opção foi a resposta do usuário
                    if (userAnswerKey === key) {
                        radio.checked = true;
                    }
                    
                    // Se o usuário respondeu, marca a correção/incorreção
                    if (userAnswerKey) {
                        if (key.toLowerCase() === correctAnswerKey.toLowerCase()) {
                            label.className = 'correct';
                        } else if (key.toLowerCase() === userAnswerKey.toLowerCase() && key.toLowerCase() !== correctAnswerKey.toLowerCase()) {
                            label.className = 'incorrect';
                        }
                        radio.disabled = true; // Desabilita após responder
                    }

                    label.innerHTML = `<input type="radio" name="question-${index}" id="${radioId}" value="${key}" ${userAnswerKey ? 'disabled' : ''} ${userAnswerKey === key ? 'checked' : ''} onchange="handleAnswer(${index}, '${key}', '${correctAnswerKey}')"><span>**${key.toUpperCase()}** - ${optionText}</span>`;

                    optionsDiv.appendChild(label);
                }
            }
            card.appendChild(optionsDiv);

            // Comentário (Se a questão foi respondida)
            if (userAnswerKey && explanation) {
                const commentDiv = document.createElement('div');
                commentDiv.className = 'comment';
                commentDiv.innerHTML = `<h4>Comentário do Professor</h4><p>${explanation}</p>`;
                card.appendChild(commentDiv);
            }
            
            container.appendChild(card);
            
            // Atualiza botões de navegação
            document.getElementById('prev-btn').disabled = index === 0;
            document.getElementById('next-btn').disabled = index === currentQuizData.questoes.length - 1;
            
            // Rola para o topo da questão
            document.getElementById('main-content').scrollTop = 0;
        }

        function handleAnswer(index, selectedKey, correctAnswerKey) {
            userAnswers[index] = selectedKey;
            
            // Recarrega a questão para mostrar o gabarito e o comentário
            renderQuestion(index);
            
            // Atualiza a contagem de score na sidebar
            updateScoreDisplay();
        }

        function changeQuestion(delta) {
            const newIndex = currentQuestionIndex + delta;
            if (newIndex >= 0 && newIndex < currentQuizData.questoes.length) {
                currentQuestionIndex = newIndex;
                renderQuestion(currentQuestionIndex);
            }
        }
        
        function updateScoreDisplay() {
            let correctCount = 0;
            let incorrectCount = 0;
            const totalQuestions = currentQuizData ? currentQuizData.questoes.length : 0;

            for (const index in userAnswers) {
                if (currentQuizData && currentQuizData.questoes[index]) {
                    const question = currentQuizData.questoes[index];
                    const correctAnswerKey = (question.resposta_correta || question.resposta || '').toLowerCase();
                    const userAnswerKey = userAnswers[index].toLowerCase();

                    if (userAnswerKey === correctAnswerKey) {
                        correctCount++;
                    } else {
                        incorrectCount++;
                    }
                }
            }

            document.getElementById('correct-count').textContent = correctCount;
            document.getElementById('incorrect-count').textContent = incorrectCount;
            document.getElementById('total-count').textContent = totalQuestions;
        }

        function showResults() {
            if (!currentQuizData) return;

            const resultsContainer = document.getElementById('results-container');
            const totalQuestions = currentQuizData.questoes.length;
            const correctCount = parseInt(document.getElementById('correct-count').textContent);
            const answeredCount = Object.keys(userAnswers).length;
            const incorrectCount = answeredCount - correctCount;
            const unansweredCount = totalQuestions - answeredCount;
            const percentage = (correctCount / totalQuestions) * 100;

            resultsContainer.innerHTML = `
                <h2>Resultado Final do Simulado</h2>
                <div class="stat">Questões no Simulado: <strong>${totalQuestions}</strong></div>
                <div class="stat">Questões Respondidas: <strong>${answeredCount}</strong></div>
                <div class="stat">Questões Não Respondidas: <strong>${unansweredCount}</strong></div>
                <div class="stat stat-correct">Acertos: <strong>${correctCount}</strong></div>
                <div class="stat stat-incorrect">Erros: <strong>${incorrectCount}</strong></div>
                <div class="stat" style="font-size: 1.3rem; margin-top: 15px;">Aproveitamento: <strong>${percentage.toFixed(2)}%</strong></div>
            `;
            
            document.getElementById('quiz-container').innerHTML = ''; // Limpa as questões
            document.getElementById('navigation-buttons').style.display = 'none';
            resultsContainer.style.display = 'block';
        }

        window.onload = loadSimulados;
    </script>
</body>
</html>
