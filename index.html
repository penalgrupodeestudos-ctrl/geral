<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Simulados Pol√≠cia Penal ES 2025 | Plataforma de Prepara√ß√£o</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; color: #333; }
    
    header { background: linear-gradient(90deg, #08306b 0%, #0b6ef0 100%); color: #fff; padding: 20px; text-align: center; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
    header h1 { font-size: 2.2em; margin-bottom: 5px; text-shadow: 1px 1px 3px rgba(0,0,0,0.3); }
    header p { font-size: 14px; opacity: 0.9; }
    
    .admin-bar { background: #fff9e6; border-bottom: 3px solid #f39c12; padding: 12px 20px; display: flex; gap: 12px; align-items: center; flex-wrap: wrap; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .admin-bar label { font-weight: 600; color: #333; }
    .admin-bar select, .admin-bar input { padding: 6px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; }
    .btn { cursor: pointer; padding: 8px 16px; border: none; border-radius: 6px; font-size: 13px; font-weight: 600; transition: all 0.3s; }
    .btn-primary { background: #0b6ef0; color: #fff; }
    .btn-primary:hover { background: #0a5ac0; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(11, 110, 240, 0.3); }
    .btn-admin { background: #f39c12; color: #000; }
    .btn-admin:hover { background: #d68910; }
    .btn-success { background: #27ae60; color: #fff; }
    .btn-danger { background: #e74c3c; color: #fff; }
    
    main { max-width: 1200px; margin: 20px auto; padding: 0 10px; min-height: calc(100vh - 300px); }
    
    .secao-simulados { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 30px; }
    .card-simulado { background: #fff; border-radius: 10px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); transition: all 0.3s; border-left: 5px solid #0b6ef0; }
    .card-simulado:hover { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(0,0,0,0.15); }
    .card-simulado h3 { color: #08306b; margin-bottom: 10px; font-size: 1.3em; }
    .card-simulado p { color: #666; font-size: 14px; margin-bottom: 15px; }
    .btn-iniciar { width: 100%; margin-bottom: 8px; }
    
    .secao-questoes { background: #fff; border-radius: 10px; padding: 25px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    .secao-questoes h2 { color: #08306b; margin-bottom: 15px; border-bottom: 3px solid #0b6ef0; padding-bottom: 10px; }
    
    .materia-grupo { margin-bottom: 30px; background: #f9f9f9; border-radius: 8px; padding: 15px; border-left: 4px solid #0b6ef0; }
    .materia-grupo h3 { color: #0b6ef0; margin-bottom: 15px; font-size: 1.1em; }
    
    .questao-item { background: #fff; margin-bottom: 15px; padding: 15px; border-radius: 8px; border: 1px solid #e0e0e0; }
    .questao-item.respondida { border-left: 4px solid #27ae60; }
    .questao-numero { color: #08306b; font-weight: 700; margin-bottom: 8px; }
    .questao-texto { margin-bottom: 12px; font-size: 15px; line-height: 1.5; }
    .questao-opcoes { margin-bottom: 12px; }
    .opcao { display: flex; align-items: center; margin-bottom: 8px; }
    .opcao input { margin-right: 10px; cursor: pointer; }
    .opcao label { cursor: pointer; flex: 1; }
    .explicacao-toggle { background: #e8f4f8; padding: 8px 12px; border-radius: 4px; cursor: pointer; margin-top: 10px; color: #0b6ef0; font-size: 13px; font-weight: 600; }
    .explicacao-texto { background: #eaf0fb; padding: 12px; margin-top: 10px; border-left: 3px solid #0b6ef0; border-radius: 4px; display: none; }
    .explicacao-texto.ativa { display: block; }
    
    .barra-progresso { background: #e0e0e0; height: 25px; border-radius: 12px; overflow: hidden; margin: 15px 0; }
    .barra-progresso-fill { height: 100%; background: linear-gradient(90deg, #27ae60 0%, #2ecc71 100%); display: flex; align-items: center; justify-content: center; color: #fff; font-size: 12px; font-weight: bold; transition: width 0.3s; }
    
    .resultado { background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%); padding: 25px; border-radius: 10px; border-left: 5px solid #0b6ef0; margin: 25px 0; }
    .resultado h2 { color: #08306b; margin-bottom: 15px; }
    .resultado-destaque { font-size: 2em; color: #0b6ef0; font-weight: 700; margin: 15px 0; }
    .resultado-linha { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #e0e0e0; }
    
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; }
    .modal.ativo { display: flex; }
    .modal-conteudo { background: #fff; border-radius: 10px; padding: 30px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; box-shadow: 0 8px 30px rgba(0,0,0,0.3); }
    .modal-conteudo h2 { color: #08306b; margin-bottom: 15px; }
    .form-grupo { margin-bottom: 15px; }
    .form-grupo label { display: block; margin-bottom: 5px; font-weight: 600; color: #333; }
    .form-grupo input, .form-grupo textarea, .form-grupo select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; }
    .form-grupo textarea { resize: vertical; min-height: 100px; }
    .form-grupo-opcoes { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
    .form-grupo-opcoes input { padding: 8px; }
    .btn-grupo { display: flex; gap: 10px; margin-top: 20px; justify-content: flex-end; }
    .btn-fechar { background: #95a5a6; color: #fff; }
    
    .checkbox-label { display: flex; align-items: center; margin: 10px 0; }
    .checkbox-label input { margin-right: 8px; width: auto; }
    
    footer { background: #08306b; color: #fff; text-align: center; padding: 20px; margin-top: 30px; }
    
    @media (max-width: 768px) {
      header h1 { font-size: 1.5em; }
      .secao-simulados { grid-template-columns: 1fr; }
      .admin-bar { flex-direction: column; gap: 8px; }
      .admin-bar > * { width: 100%; }
    }
  </style>
</head>
<body>
<header>
  <h1>üéì Simulados Pol√≠cia Penal ES</h1>
  <p>Edital 01/2025 | 60 Quest√µes Objetivas | Prova: 30/11/2025</p>
</header>

<div class="admin-bar" id="adminBar" style="display: none;">
  <label>‚öôÔ∏è Painel Administrativo</label>
  <select id="simuladoSelect"></select>
  <button class="btn btn-admin" onclick="adminRenomear()">üìù Renomear</button>
  <button class="btn btn-admin" onclick="adminExcluir()">üóëÔ∏è Excluir</button>
  <button class="btn btn-admin" onclick="adminEditarExplicacoes()">‚úèÔ∏è Editar Explica√ß√µes</button>
  <button class="btn btn-admin" onclick="abrirModalNovoSimulado()">‚ûï Novo Simulado</button>
  <button class="btn btn-admin" onclick="abrirModalImportar()">üì• Importar Simulado</button>
</div>

<main>
  <div id="telaInicial">
    <div class="secao-simulados" id="listaSim ulados"></div>
  </div>
  
  <div id="telaQuestoes" style="display: none;">
    <div class="secao-questoes">
      <h2 id="tituloSimulado"></h2>
      <div class="barra-progresso">
        <div class="barra-progresso-fill" id="barraProgresso" style="width: 0%">0%</div>
      </div>
      <label class="checkbox-label">
        <input type="checkbox" id="toggleExplicacoes" onchange="toggleExplicacoes()">
        Mostrar Explica√ß√µes do Professor
      </label>
      <div id="questoesContainer"></div>
      <div style="display: flex; gap: 10px; margin-top: 25px;">
        <button class="btn btn-primary" style="flex: 1; padding: 12px;" onclick="corrigirSimulado()">‚úÖ Corrigir Simulado</button>
        <button class="btn btn-fechar" style="flex: 0; padding: 12px 25px;" onclick="voltarAoInicio()">‚Üê Voltar</button>
      </div>
    </div>
    <div id="resultadoContainer"></div>
  </div>
</main>

<!-- Modal Novo Simulado -->
<div class="modal" id="modalNovoSimulado">
  <div class="modal-conteudo">
    <h2>Criar Novo Simulado</h2>
    <div class="form-grupo">
      <label>Nome do Simulado:</label>
      <input type="text" id="nomeNovoSimulado" placeholder="Ex: Simulado Pol√≠cia Penal 3">
    </div>
    <div class="form-grupo">
      <label>Descri√ß√£o:</label>
      <textarea id="descricaoSimulado" placeholder="Ex: 60 quest√µes para prepara√ß√£o"></textarea>
    </div>
    <h3 style="color: #08306b; margin-top: 20px; margin-bottom: 10px;">Adicionar Quest√µes (m√≠nimo 1):</h3>
    <div id="questoesNovas"></div>
    <button class="btn btn-primary" onclick="adicionarCampoQuestao()" style="width: 100%; margin-bottom: 15px;">+ Adicionar Quest√£o</button>
    <div class="btn-grupo">
      <button class="btn btn-fechar" onclick="fecharModal('modalNovoSimulado')">Cancelar</button>
      <button class="btn btn-success" onclick="salvarNovoSimulado()">üíæ Salvar & Exportar</button>
    </div>
  </div>
</div>

<!-- Modal Importar -->
<div class="modal" id="modalImportar">
  <div class="modal-conteudo">
    <h2>Importar Simulado (JSON)</h2>
    <div class="form-grupo">
      <label>Cole aqui o JSON do simulado:</label>
      <textarea id="jsonImportar" placeholder='Colar JSON do simulado aqui. Exemplo: [{"numero":1,"disciplina":"...","questao":"...","opcoes":{"A":"...","B":"...","C":"...","D":"..."},"resposta_correta":"A","explicacao_professor":"..."}]' style="min-height: 200px;"></textarea>
    </div>
    <div class="btn-grupo">
      <button class="btn btn-fechar" onclick="fecharModal('modalImportar')">Cancelar</button>
      <button class="btn btn-success" onclick="importarSimulado()">üì§ Importar</button>
    </div>
  </div>
</div>

<footer>
  <p>Prepare-se para o concurso da Pol√≠cia Penal ES | Edital 01/2025</p>
</footer>

<script>
const MATERIAS = [
  { nome: "L√≠ngua Portuguesa", qtd: 10 },
  { nome: "Racioc√≠nio L√≥gico-Matem√°tico", qtd: 10 },
  { nome: "Inform√°tica", qtd: 5 },
  { nome: "Atualidades", qtd: 5 },
  { nome: "√âtica no Servi√ßo P√∫blico", qtd: 5 },
  { nome: "Conhecimentos Espec√≠ficos", qtd: 25 }
];

let simulados = JSON.parse(localStorage.getItem('simulados')) || [
  { id: 1, nome: "Simulado Pol√≠cia Penal 1", path: "data/SIMULADO-POLICIA-PENAL-JSON.json", dados: null },
  { id: 2, nome: "Simulado Pol√≠cia Penal 2", path: "data/SIMULADO-POLICIA-PENAL02-JSON.json", dados: null }
];

let admin = false;
let simuladoAtual = null;
let respostas = {};
let questoesAtual = [];
let mostraExplicacoes = false;
let proximoId = Math.max(...simulados.map(s => s.id || 0)) + 1;

window.onload = () => {
  if (location.search.includes("admin")) admin = true;
  doc('adminBar').style.display = admin ? 'flex' : 'none';
  atualizarListaSimulados();
};

function doc(id) { return document.getElementById(id); }

function atualizarListaSimulados() {
  const lista = doc('listaSim ulados');
  lista.innerHTML = '';
  simulados.forEach((sim, idx) => {
    const html = `
      <div class="card-simulado">
        <h3>${sim.nome}</h3>
        <p>üìÅ ${sim.path}</p>
        <button class="btn btn-primary btn-iniciar" onclick="iniciarSimulado(${idx})">Iniciar Simulado</button>
        ${admin ? `<button class="btn btn-admin" style="width: 100%;" onclick="selecionarSimuladoAdmin(${idx})">‚öôÔ∏è Admin</button>` : ''}
      </div>
    `;
    lista.innerHTML += html;
  });
  if (admin) atualizarDropdownAdmin();
  salvarSimuladosLocalStorage();
}

function atualizarDropdownAdmin() {
  const sel = doc('simuladoSelect');
  sel.innerHTML = simulados.map((s, i) => `<option value="${i}">${s.nome}</option>`).join('');
}

function selecionarSimuladoAdmin(idx) {
  doc('simuladoSelect').value = idx;
}

function iniciarSimulado(idx) {
  simuladoAtual = idx;
  doc('telaInicial').style.display = 'none';
  doc('telaQuestoes').style.display = 'block';
  
  carregarQuestoes(idx).then(() => {
    doc('tituloSimulado').textContent = simulados[idx].nome;
    mostrarQuestoes();
    respostas = {};
    atualizarProgresso();
  });
}

async function carregarQuestoes(idx) {
  const sim = simulados[idx];
  
  if (sim.dados) {
    questoesAtual = sim.dados;
    return;
  }
  
  try {
    const response = await fetch(SIMULADOS EM JSON);
    if (!response.ok) throw new Error(`HTTP ${response.status}`);
    const dados = await response.json();
    
    // Filtrar e distribuir quest√µes por mat√©ria
    let questoesFiltradas = [SIMULADOS EM JSON];
    MATERIAS.forEach(mat => {
      let qMat = dados.filter(q => q.disciplina && q.disciplina.trim() === mat.nome.trim());
      questoesFiltradas = questoesFiltradas.concat(qMat.slice(0, mat.qtd));
    });
    
    questoesAtual = questoesFiltradas;
    sim.dados = questoesFiltradas;
  } catch (err) {
    alert(`‚ùå Erro ao carregar ${sim.nome}: ${err.message}`);
    voltarAoInicio();
  }
}

function mostrarQuestoes() {
  const container = doc('questoesContainer');
  container.innerHTML = '';
  
  MATERIAS.forEach(mat => {
    const qMat = questoesAtual.filter(q => q.disciplina && q.disciplina.trim() === mat.nome.trim());
    if (qMat.length === 0) return;
    
    const htmlMateria = `<div class="materia-grupo">
      <h3>${mat.nome} (${qMat.length}/${mat.qtd})</h3>
      ${qMat.map((q, i) => {
        const idxGlobal = questoesAtual.indexOf(q);
        const respondida = respostas[idxGlobal] ? 'respondida' : '';
        return `
          <div class="questao-item ${respondida}">
            <div class="questao-numero">Quest√£o ${idxGlobal + 1}</div>
            <div class="questao-texto">${q.questao}</div>
            <div class="questao-opcoes">
              ${['A', 'B', 'C', 'D', 'E'].map(letra => {
                if (!q.opcoes[letra]) return '';
                return `
                  <div class="opcao">
                    <input type="radio" name="q${idxGlobal}" value="${letra}" 
                      ${respostas[idxGlobal] === letra ? 'checked' : ''}
                      onchange="selecionarResposta(${idxGlobal}, '${letra}')">
                    <label><strong>${letra}.</strong> ${q.opcoes[letra]}</label>
                  </div>
                `;
              }).join('')}
            </div>
            ${q.explicacao_professor ? `
              <div class="explicacao-toggle" onclick="toggleExplicacao(this)">üí° Ver Explica√ß√£o</div>
              <div class="explicacao-texto" style="display: ${mostraExplicacoes ? 'block' : 'none'};">
                <strong>üìö Explica√ß√£o:</strong> ${q.explicacao_professor}
              </div>
            ` : ''}
          </div>
        `;
      }).join('')}
    </div>`;
    container.innerHTML += htmlMateria;
  });
}

function selecionarResposta(idx, letra) {
  respostas[idx] = letra;
  atualizarProgresso();
}

function toggleExplicacoes() {
  mostraExplicacoes = doc('toggleExplicacoes').checked;
  document.querySelectorAll('.explicacao-texto').forEach(el => {
    el.style.display = mostraExplicacoes ? 'block' : 'none';
  });
}

function toggleExplicacao(el) {
  const explicacao = el.nextElementSibling;
  if (explicacao && explicacao.classList.contains('explicacao-texto')) {
    explicacao.classList.toggle('ativa');
  }
}

function atualizarProgresso() {
  const total = questoesAtual.length;
  const respondidas = Object.keys(respostas).length;
  const percentual = Math.round((respondidas / total) * 100);
  const barra = doc('barraProgresso');
  barra.style.width = percentual + '%';
  barra.textContent = percentual + '%';
}

function corrigirSimulado() {
  let acertos = 0;
  const total = questoesAtual.length;
  const detalhes = [];
  const resultadoPorMateria = {};
  
  MATERIAS.forEach(mat => resultadoPorMateria[mat.nome] = { acertos: 0, total: 0 });
  
  questoesAtual.forEach((q, idx) => {
    const resposta = respostas[idx] || '‚Äî';
    const correta = q.resposta_correta;
    const acertou = resposta === correta;
    if (acertou) acertos++;
    
    const materia = q.disciplina || 'Outros';
    resultadoPorMateria[materia].total++;
    if (acertou) resultadoPorMateria[materia].acertos++;
    
    detalhes.push({
      questao: idx + 1,
      disciplina: materia,
      respondeu: resposta,
      correta: correta,
      acertou: acertou,
      explicacao: q.explicacao_professor
    });
  });
  
  const percentual = Math.round((acertos / total) * 100);
  const pontuacao = acertos;
  
  let html = `<div class="resultado">
    <h2>üìä Resultado do Simulado</h2>
    <div class="resultado-destaque">üéØ ${acertos} de ${total} acertos (${percentual}%)</div>
    <div class="resultado-destaque" style="font-size: 1.5em; color: #27ae60;">Pontua√ß√£o: ${pontuacao}/60 pontos</div>
    
    <h3 style="color: #08306b; margin-top: 20px; margin-bottom: 10px;">üìà Desempenho por Mat√©ria:</h3>`;
  
  Object.entries(resultadoPorMateria).forEach(([mat, dados]) => {
    if (dados.total > 0) {
      const pct = Math.round((dados.acertos / dados.total) * 100);
      const cor = pct >= 70 ? '#27ae60' : pct >= 50 ? '#f39c12' : '#e74c3c';
      html += `
        <div class="resultado-linha">
          <span>${mat}</span>
          <span style="color: ${cor}; font-weight: bold;">${dados.acertos}/${dados.total} (${pct}%)</span>
        </div>
      `;
    }
  });
  
  html += `<h3 style="color: #08306b; margin-top: 20px; margin-bottom: 10px;">üìã Detalhado:</h3>
    <div style="max-height: 300px; overflow-y: auto;">`;
  
  detalhes.forEach(d => {
    const corClass = d.acertou ? 'style="color: #27ae60;"' : 'style="color: #e74c3c;"';
    const icon = d.acertou ? '‚úÖ' : '‚ùå';
    html += `
      <div style="padding: 10px; border-bottom: 1px solid #e0e0e0; margin-bottom: 10px;">
        <strong>Q${d.questao} (${d.disciplina})</strong> ${icon}
        <div ${corClass}>Respondeu: <strong>${d.respondeu}</strong> | Correto: <strong>${d.correta}</strong></div>
        ${d.explicacao ? `<small style="color: #666; display: block; margin-top: 5px;">üí° ${d.explicacao}</small>` : ''}
      </div>
    `;
  });
  
  html += `</div><button class="btn btn-primary" style="width: 100%; margin-top: 15px;" onclick="voltarAoInicio()">‚Üê Voltar aos Simulados</button></div>`;
  
  doc('resultadoContainer').innerHTML = html;
  doc('questoesContainer').style.display = 'none';
  document.querySelector('.secao-questoes > div:last-child').style.display = 'none';
}

function voltarAoInicio() {
  doc('telaInicial').style.display = 'block';
  doc('telaQuestoes').style.display = 'none';
  doc('resultadoContainer').innerHTML = '';
  doc('questoesContainer').innerHTML = '';
  doc('questoesContainer').style.display = 'block';
  document.querySelector('.secao-questoes > div:last-child').style.display = 'flex';
  mostraExplicacoes = false;
  doc('toggleExplicacoes').checked = false;
}

// ============ FUN√á√ïES ADMIN ============

function adminRenomear() {
  const idx = parseInt(doc('simuladoSelect').value);
  const novoNome = prompt('Novo nome:', simulados[idx].nome);
  if (novoNome) {
    simulados[idx].nome = novoNome;
    atualizarListaSimulados();
  }
}

function adminExcluir() {
  const idx = parseInt(doc('simuladoSelect').value);
  if (confirm(`Excluir "${simulados[idx].nome}"?`)) {
    simulados.splice(idx, 1);
    atualizarListaSimulados();
  }
}

function adminEditarExplicacoes() {
  const idx = parseInt(doc('simuladoSelect').value);
  carregarQuestoes(idx).then(() => {
    const modal = document.createElement('div');
    modal.className = 'modal ativo';
    modal.id = 'modalEditarExplicacoes';
    let conteudo = '<div class="modal-conteudo"><h2>Editar Explica√ß√µes</h2><div style="max-height: 400px; overflow-y: auto;">';
    
    questoesAtual.forEach((q, i) => {
      conteudo += `
        <div class="form-grupo">
          <label><strong>Q${i + 1} (${q.disciplina})</strong></label>
          <textarea id="exp${i}" style="font-size: 12px;">${q.explicacao_professor || ''}</textarea>
        </div>
      `;
    });
    
    conteudo += `</div><div class="btn-grupo">
      <button class="btn btn-fechar" onclick="this.closest('.modal').remove()">Cancelar</button>
      <button class="btn btn-success" onclick="salvarExplicacoes(${idx})">üíæ Salvar</button>
    </div></div>`;
    
    modal.innerHTML = conteudo;
    document.body.appendChild(modal);
  });
}

function salvarExplicacoes(idx) {
  questoesAtual.forEach((q, i) => {
    q.explicacao_professor = doc('exp' + i).value;
  });
  simulados[idx].dados = questoesAtual;
  document.getElementById('modalEditarExplicacoes').remove();
  alert('‚úÖ Explica√ß√µes salvas!');
  atualizarListaSimulados();
}

function abrirModalNovoSimulado() {
  adicionarCampoQuestao();
  abrirModal('modalNovoSimulado');
}

function adicionarCampoQuestao() {
  const container = doc('questoesNovas');
  const id = container.children.length;
  const html = `
    <div class="form-grupo" id="q${id}">
      <label>Quest√£o ${id + 1}</label>
      <select class="disciplina-q${id}" onchange="updateDisciplinaQ${id}()" style="margin-bottom: 8px;">
        <option>Selecione a mat√©ria...</option>
        ${MATERIAS.map(m => `<option>${m.nome}</option>`).join('')}
      </select>
      <textarea placeholder="Texto da quest√£o" class="questao-q${id}" style="margin-bottom: 8px;"></textarea>
      <div class="form-grupo-opcoes">
        <input type="text" placeholder="Op√ß√£o A" class="opcaoA-q${id}">
        <input type="text" placeholder="Op√ß√£o B" class="opcaoB-q${id}">
        <input type="text" placeholder="Op√ß√£o C" class="opcaoC-q${id}">
        <input type="text" placeholder="Op√ß√£o D" class="opcaoD-q${id}">
      </div>
      <div style="display: flex; gap: 10px; margin-bottom: 10px;">
        <select class="resposta-q${id}" style="flex: 0.3;">
          <option>A</option>
          <option>B</option>
          <option>C</option>
          <option>D</option>
        </select>
        <textarea placeholder="Explica√ß√£o do professor" class="explicacao-q${id}" style="flex: 1; min-height: 60px;"></textarea>
      </div>
      <button class="btn btn-danger" style="width: 100%;" onclick="doc('q${id}').remove()">Remover</button>
    </div>
  `;
  container.innerHTML += html;
}

function salvarNovoSimulado() {
  const nome = doc('nomeNovoSimulado').value.trim();
  const descricao = doc('descricaoSimulado').value.trim();
  
  if (!nome) { alert('Digite o nome do simulado'); return; }
  
  const questoes = [];
  const container = doc('questoesNovas');
  
  Array.from(container.children).forEach((el, idx) => {
    const disciplina = el.querySelector('.disciplina-q' + idx).value;
    const questao = el.querySelector('.questao-q' + idx).value.trim();
    const opcaoA = el.querySelector('.opcaoA-q' + idx).value.trim();
    const opcaoB = el.querySelector('.opcaoB-q' + idx).value.trim();
    const opcaoC = el.querySelector('.opcaoC-q' + idx).value.trim();
    const opcaoD = el.querySelector('.opcaoD-q' + idx).value.trim();
    const resposta = el.querySelector('.resposta-q' + idx).value;
    const explicacao = el.querySelector('.explicacao-q' + idx).value.trim();
    
    if (disciplina !== 'Selecione a mat√©ria...' && questao && opcaoA && opcaoB && opcaoC && opcaoD) {
      questoes.push({
        numero: idx + 1,
        disciplina: disciplina,
        questao: questao,
        opcoes: { A: opcaoA, B: opcaoB, C: opcaoC, D: opcaoD },
        resposta_correta: resposta,
        explicacao_professor: explicacao
      });
    }
  });
  
  if (questoes.length === 0) { alert('Adicione pelo menos uma quest√£o completa'); return; }
  
  const simuladoJSON = JSON.stringify(questoes, null, 2);
  
  // Preparar download
  const element = document.createElement('a');
  element.setAttribute('href', 'data:application/json;charset=utf-8,' + encodeURIComponent(simuladoJSON));
  element.setAttribute('download', `${nome.replace(/\s+/g, '-')}-${Date.now()}.json`);
  document.body.appendChild(element);
  element.click();
  document.body.removeChild(element);
  
  alert(`‚úÖ Simulado exportado! Coloque o arquivo na pasta "/data/" para usar na plataforma.`);
  
  // Limpar e fechar
  doc('nomeNovoSimulado').value = '';
  doc('descricaoSimulado').value = '';
  doc('questoesNovas').innerHTML = '';
  fecharModal('modalNovoSimulado');
}

function abrirModalImportar() {
  abrirModal('modalImportar');
}

function importarSimulado() {
  const json = doc('jsonImportar').value.trim();
  try {
    const questoes = JSON.parse(json);
    if (!Array.isArray(questoes)) throw new Error('JSON deve ser um array');
    
    const nome = prompt('Nome do simulado:');
    if (!nome) return;
    
    simulados.push({
      id: proximoId++,
      nome: nome,
      path: `data/${nome.replace(/\s+/g, '-')}.json`,
      dados: questoes
    });
    
    atualizarListaSimulados();
    alert('‚úÖ Simulado importado com sucesso!');
    fecharModal('modalImportar');
  } catch (err) {
    alert('‚ùå JSON inv√°lido: ' + err.message);
  }
}

function abrirModal(id) {
  doc(id).classList.add('ativo');
}

function fecharModal(id) {
  doc(id).classList.remove('ativo');
}

function salvarSimuladosLocalStorage() {
  localStorage.setItem('simulados', JSON.stringify(simulados.map(s => ({ ...s, dados: null }))));
}

// Fechar modal ao clicar fora
document.addEventListener('click', (e) => {
  if (e.target.classList.contains('modal')) {
    e.target.classList.remove('ativo');
  }
});
</script>
</body>
</html>
