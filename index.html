<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PROJETO SABER - Pol√≠cia Penal ES</title>
<style>
/* === ESTILO ORIGINAL MANTIDO === */
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;
background:linear-gradient(135deg,#1e3c72 0%,#2a5298 100%);
color:#333;min-height:100vh;padding:20px}
.container{max-width:1200px;margin:0 auto}
header{background:linear-gradient(135deg,#2c3e50 0%,#3498db 100%);
color:white;padding:30px;border-radius:15px;margin-bottom:30px;text-align:center;
box-shadow:0 10px 30px rgba(0,0,0,0.2)}
header h1{font-size:2.3rem;margin-bottom:10px}
.menu-principal{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));
gap:20px;margin-bottom:30px}
.card-simulado{background:white;padding:30px;border-radius:15px;
box-shadow:0 5px 20px rgba(0,0,0,0.1);text-align:center;transition:all .3s ease;cursor:pointer}
.card-simulado:hover{transform:translateY(-10px);
box-shadow:0 15px 40px rgba(0,0,0,0.2)}
.card-simulado h3{color:#2c3e50;margin-bottom:15px;font-size:1.4rem}
.card-simulado .info{background:#f0f0f0;padding:15px;border-radius:10px;margin:15px 0;
font-size:.9rem;text-align:left}
.btn{background:linear-gradient(135deg,#3498db,#2980b9);color:white;
border:none;padding:12px 30px;border-radius:8px;cursor:pointer;font-size:1rem;
transition:all .3s ease;margin-top:10px;width:100%}
.btn:hover{background:linear-gradient(135deg,#2980b9,#1e5a96)}
.btn-voltar{background:linear-gradient(135deg,#95a5a6 0%,#7f8c8d 100%);
padding:10px 20px;font-size:.9rem;width:auto;margin-bottom:20px}
.hidden{display:none!important}
.quiz-interface{background:white;padding:40px;border-radius:15px;
box-shadow:0 10px 30px rgba(0,0,0,0.2)}
.enunciado{background:#f9f9f9;padding:25px;border-radius:10px;margin:20px 0;
font-size:1.05rem;line-height:1.8;border-left:4px solid #3498db}
.opcoes{display:grid;gap:12px;margin:25px 0}
.opcao{background:white;border:2px solid #ecf0f1;padding:15px;border-radius:10px;
cursor:pointer;transition:all .3s ease;font-size:1rem;text-align:left}
.opcao:hover:not(:disabled){border-color:#3498db;background:#f8f9fa}
.opcao.correta{background:#d4edda;border-color:#28a745;color:#155724}
.opcao.incorreta{background:#f8d7da;border-color:#dc3545;color:#721c24}
.opcao:disabled{cursor:not-allowed}
.resultado-final{background:linear-gradient(135deg,#27ae60,#229954);
color:white;padding:40px;border-radius:15px;text-align:center;display:none}
.resultado-final.ativo{display:block}
@media(max-width:768px){header h1{font-size:1.8rem}.menu-principal{grid-template-columns:1fr}.quiz-interface{padding:20px}}
</style>
</head>
<body>
<div class="container">
<header><h1>üéì PROJETO SABER</h1><p>Simulados Pol√≠cia Penal ES</p></header>

<!-- MENU PRINCIPAL -->
<div id="telaPrincipal">
  <div class="menu-principal" id="menuSimulados"></div>
</div>

<!-- QUIZ -->
<div id="quizContainer" class="hidden">
  <button class="btn btn-voltar" onclick="voltarMenu()">‚Üê Voltar</button>
  <div class="quiz-interface">
    <div class="enunciado" id="enunciado"></div>
    <div class="opcoes" id="opcoes"></div>
    <div id="explicacao" style="display:none;background:#eef;padding:10px;border-radius:10px;margin-top:10px"></div>
    <div style="margin-top:20px;text-align:center">
      <button class="btn" onclick="questaoAnterior()">‚Üê Anterior</button>
      <button class="btn" onclick="questaoProxima()">Pr√≥xima ‚Üí</button>
    </div>
  </div>
</div>

<!-- RESULTADO -->
<div id="resultadoContainer" class="resultado-final">
  <button class="btn btn-voltar" onclick="voltarMenu()" style="background:#fff;color:#2c3e50">‚Üê Menu</button>
  <h2>‚úÖ Simulado Finalizado!</h2>
  <p><strong>Acertos:</strong> <span id="totalAcertos">0</span></p>
  <p><strong>Erros:</strong> <span id="totalErros">0</span></p>
  <p><strong>Pontua√ß√£o:</strong> <span id="pontuacao">0%</span></p>
</div>
</div>

<script>
let simulados = {};
let questoesFiltradas = [];
let simuladoAtual = 0;
let questaoAtual = 0;
let respostas = {};

async function carregarManifest() {
  try {
    const r = await fetch('data/simulados-manifest.json');
    simulados = await r.json();
    montarMenu();
  } catch(e) {
    console.error('Erro manifest:', e);
    document.getElementById('menuSimulados').innerHTML='<p style="color:white">Erro ao carregar manifest.</p>';
  }
}

function montarMenu() {
  const menu = document.getElementById('menuSimulados');
  menu.innerHTML = '';
  for (const [id, s] of Object.entries(simulados)) {
    menu.innerHTML += `
      <div class="card-simulado" onclick="iniciarSimulado(${id})">
        <h3>üìò ${s.nome}</h3>
        <div class="info"><strong>${s.total} Quest√µes</strong><br>${s.descricao||''}</div>
        <button class="btn">FAZER SIMULADO</button>
      </div>`;
  }
}

async function iniciarSimulado(num) {
  try {
    const sim = simulados[num];
    const resp = await fetch(sim.arquivo);
    if (!resp.ok) throw new Error('Arquivo n√£o encontrado: '+sim.arquivo);
    const dados = await resp.json();
    questoesFiltradas = Array.isArray(dados) ? dados : (dados.questoes || []);
    if (!questoesFiltradas.length) throw new Error('Nenhuma quest√£o encontrada.');
    questaoAtual = 0; respostas = {};
    document.getElementById('telaPrincipal').classList.add('hidden');
    document.getElementById('quizContainer').classList.remove('hidden');
    exibirQuestao();
  } catch(e) {
    console.error(e);
    alert('Erro ao iniciar simulado: ' + e.message);
  }
}

function exibirQuestao() {
  const q = questoesFiltradas[questaoAtual];
  if (!q) return;
  document.getElementById('enunciado').innerHTML = `<b>Quest√£o ${questaoAtual+1}:</b> ${q.enunciado}`;
  const op = document.getElementById('opcoes');
  op.innerHTML = '';
  q.opcoes.forEach((txt,i)=>{
    const div=document.createElement('div');
    div.className='opcao';
    div.textContent=`${String.fromCharCode(65+i)}) ${txt}`;
    div.onclick=()=>selecionar(i);
    op.appendChild(div);
  });
  document.getElementById('explicacao').style.display='none';
}

function selecionar(i){
  const q = questoesFiltradas[questaoAtual];
  respostas[questaoAtual]=i;
  document.querySelectorAll('.opcao').forEach((el,idx)=>{
    el.disabled=true;
    if (idx===q.gabarito) el.classList.add('correta');
    else if (idx===i) el.classList.add('incorreta');
  });
  const exp=document.getElementById('explicacao');
  exp.innerHTML = `<b>Explica√ß√£o:</b> ${q.explicacao||'Sem explica√ß√£o dispon√≠vel.'}`;
  exp.style.display='block';
}

function questaoProxima(){
  if (questaoAtual<questoesFiltradas.length-1){questaoAtual++;exibirQuestao();}
  else finalizarSimulado();
}
function questaoAnterior(){
  if (questaoAtual>0){questaoAtual--;exibirQuestao();}
}
function finalizarSimulado(){
  let acertos=0;
  questoesFiltradas.forEach((q,i)=>{if(respostas[i]===q.gabarito)acertos++;});
  document.getElementById('quizContainer').classList.add('hidden');
  const r=document.getElementById('resultadoContainer');
  r.classList.add('ativo');
  document.getElementById('totalAcertos').textContent=acertos;
  document.getElementById('totalErros').textContent=questoesFiltradas.length-acertos;
  document.getElementById('pontuacao').textContent=Math.round(acertos/questoesFiltradas.length*100)+'%';
}
function voltarMenu(){
  document.getElementById('telaPrincipal').classList.remove('hidden');
  document.getElementById('quizContainer').classList.add('hidden');
  document.getElementById('resultadoContainer').classList.remove('ativo');
}

document.addEventListener("DOMContentLoaded",()=>carregarManifest());
</script>
</body>
</html>
