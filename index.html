<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulados Estrat√©gia Universal</title>
<style>
body {
  font-family: "Segoe UI", Arial, sans-serif;
  margin: 0;
  background: #f5f7fa;
  display: flex;
  flex-direction: row;
}
aside {
  width: 280px;
  background: #003366;
  color: white;
  padding: 15px;
  display: flex;
  flex-direction: column;
  box-shadow: 2px 0 5px rgba(0,0,0,0.2);
}
aside h2 {
  text-align: center;
  font-size: 18px;
  border-bottom: 1px solid #ccc;
  padding-bottom: 10px;
}
#simulados-list a {
  display: block;
  color: white;
  text-decoration: none;
  padding: 8px;
  border-radius: 4px;
  margin: 4px 0;
  background: #004d99;
  cursor: pointer;
}
#simulados-list a:hover {
  background: #0066cc;
}
#desempenho {
  background: #002b50;
  border-radius: 8px;
  padding: 10px;
  margin-top: 15px;
  font-size: 14px;
}
#quiz-area {
  flex: 1;
  padding: 25px;
  overflow-y: auto;
}
.question-card {
  background: white;
  border-radius: 10px;
  padding: 15px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.15);
  margin-bottom: 20px;
}
.question-card h3 {
  margin-top: 0;
  color: #003366;
}
.options-list {
  list-style: none;
  padding: 0;
}
.option {
  padding: 8px;
  margin-bottom: 5px;
  border: 1px solid #ccc;
  border-radius: 6px;
  cursor: pointer;
  transition: 0.2s;
}
.option:hover {
  background: #eaf2ff;
}
.option.answered {
  pointer-events: none;
}
.correct-answer {
  background: #c7f9cc !important;
  border-color: #27ae60;
}
.wrong-answer {
  background: #ffd6d6 !important;
  border-color: #e74c3c;
}
.correct-answer-revealed {
  border: 2px solid #27ae60;
}
.comment-box {
  display: none;
  margin-top: 10px;
  background: #f4f4f4;
  border-left: 4px solid #004d99;
  padding: 10px;
  border-radius: 6px;
  font-size: 14px;
}
.text-base {
  background: white;
  padding: 15px;
  border-left: 4px solid #004d99;
  border-radius: 6px;
  margin-bottom: 20px;
}
.notas {
  background: #fff;
  padding: 10px;
  border-radius: 8px;
  box-shadow: 0 0 5px #ccc;
  margin-top: 10px;
}
.notas textarea {
  width: 100%;
  height: 80px;
  border-radius: 6px;
  border: 1px solid #aaa;
  padding: 5px;
  resize: none;
}
button {
  border: none;
  padding: 6px 10px;
  border-radius: 6px;
  cursor: pointer;
  margin-right: 5px;
}
.salvar {
  background: #2ecc71;
  color: white;
}
.excluir {
  background: #e74c3c;
  color: white;
}
</style>
</head>
<body>
<aside>
  <h2>üìö Simulados</h2>
  <ul id="simulados-list"></ul>
  <div id="desempenho">
    <h3>üìä Desempenho</h3>
    <p>Acertos: <span id="acertos">0</span></p>
    <p>Erros: <span id="erros">0</span></p>
    <p>Dicas: <span id="dicas">Revise temas com mais erros</span></p>
  </div>
</aside>

<div id="quiz-area">
  <h2>Selecione um simulado √† esquerda</h2>
</div>

<script>
let acertos = 0;
let erros = 0;

// === CARREGAR QUALQUER JSON DE SIMULADO ===
async function loadQuiz(filename) {
  try {
    const response = await fetch(`./data/${encodeURIComponent(filename)}`);
    const raw = await response.json();
    const keys = ["questoes", "perguntas", "itens", "questions"];
    let questoes = [];

    if (Array.isArray(raw)) questoes = raw;
    else for (const k of keys) if (Array.isArray(raw[k])) questoes = raw[k];
    if (!questoes.length) throw new Error("Nenhuma quest√£o encontrada.");

    const texto = (typeof raw.texto_base === "string" ? raw.texto_base : "") || 
                   (typeof raw.texto === "string" ? raw.texto : "");
    const titulo = raw.titulo || filename;
    renderQuiz(titulo, texto, questoes);
  } catch (e) {
    document.getElementById("quiz-area").innerHTML = `<h3 style='color:red;'>Erro: ${e.message}</h3>`;
  }
}

// === EXIBIR QUEST√ïES ===
function renderQuiz(titulo, texto, questoes) {
  const quiz = document.getElementById("quiz-area");
  quiz.innerHTML = `<h2>${titulo}</h2>`;

  // ‚úÖ Corrigido: s√≥ adiciona texto base se for texto v√°lido
  if (texto && typeof texto === "string" && texto.trim() !== "") {
    quiz.innerHTML += `<div class='text-base'><strong>Texto Base:</strong><p>${texto.replace(/\n/g, "<br>")}</p></div>`;
  }

  questoes.forEach((q, i) => {
    const id = q.id || q.numero || i + 1;
    const enunciado = q.enunciado || q.questao || q.pergunta || q.texto || "Quest√£o sem enunciado.";
    const alternativas = q.alternativas || q.opcoes || q.options || {};
    const correta = (q.resposta_correta || q.resposta || "").toString().toLowerCase();
    const comentario = q.comentario || q.explicacao_professor || "Coment√°rio n√£o dispon√≠vel.";

    let opHTML = "";
    if (Array.isArray(alternativas)) {
      const letras = ["a", "b", "c", "d", "e"];
      opHTML = alternativas.map((alt, idx) => `
        <li class='option' data-opt='${letras[idx]}'
            onclick='checkAnswer(${id}, "${letras[idx]}", "${correta}", \`${comentario}\`)'>
            <strong>${letras[idx].toUpperCase()})</strong> ${alt}</li>`).join("");
    } else {
      opHTML = Object.entries(alternativas).map(([key, val]) => `
        <li class='option' data-opt='${key.toLowerCase()}'
            onclick='checkAnswer(${id}, "${key.toLowerCase()}", "${correta}", \`${comentario}\`)'>
            <strong>${key.toUpperCase()})</strong> ${val}</li>`).join("");
    }

    quiz.innerHTML += `
      <div class='question-card' id='questao-${id}'>
        <h3>Quest√£o ${id}</h3>
        <p>${enunciado}</p>
        <ul class='options-list'>${opHTML}</ul>
        <div class='comment-box' id='comentario-${id}'></div>
        <div class='notas'>
          <label>üìù Notas Pessoais:</label>
          <textarea id='nota-${id}' placeholder='Anote aqui...'></textarea><br>
          <button class='salvar' onclick='salvarNota(${id})'>üíæ Gravar</button>
          <button class='excluir' onclick='excluirNota(${id})'>üóëÔ∏è Excluir</button>
        </div>
      </div>`;
  });
}

// === CORRIGIR RESPOSTAS ===
function checkAnswer(id, opt, correta, comentario) {
  const qEl = document.querySelectorAll(`#questao-${id} .option`);
  qEl.forEach(e => {
    const alt = e.getAttribute("data-opt");
    if (alt === correta) e.classList.add("correct-answer-revealed");
    if (alt === opt) e.classList.add(opt === correta ? "correct-answer" : "wrong-answer");
    e.classList.add("answered");
  });

  const comment = document.getElementById(`comentario-${id}`);
  comment.style.display = "block";
  comment.innerHTML = `<strong>${opt === correta ? "‚úÖ Correto!" : "‚ùå Errado!"}</strong><br>
  <b>Gabarito:</b> ${correta.toUpperCase()}<br>${comentario}`;

  if (opt === correta) acertos++; else erros++;
  document.getElementById("acertos").textContent = acertos;
  document.getElementById("erros").textContent = erros;
}

// === NOTAS PESSOAIS ===
function salvarNota(id) {
  const texto = document.getElementById(`nota-${id}`).value;
  localStorage.setItem(`nota-${id}`, texto);
  alert("üíæ Anota√ß√£o salva!");
}
function excluirNota(id) {
  localStorage.removeItem(`nota-${id}`);
  document.getElementById(`nota-${id}`).value = "";
  alert("üóëÔ∏è Anota√ß√£o exclu√≠da!");
}

// === LISTAR SIMULADOS ===
function carregarLista() {
  const nomes = ["SIMULADO-DIREITOS-HUMANOS-JSON.json",
    "SIMULADO-IASES-JSON-COM-GABARITO.json",
    "SIMULADO-POLICIA-PENAL02.json",
    "SIMULADO-POLICIA-PENAL.json",
    "QUESTOES-GERAIS.json",
    "QUESTOES-AREA-POLICIAL.json",
    "SIMULADO-IDCAP-60-QUESTOES.json",
    "002-IDCAP-60-QUESTOES.json",
    "SIMULADO-03-IDCAP-60-QUESTOES.json",
     "ESTRATEGIA.json",
    "SIMULADO-02-IDCAP-60-QUESTOES",
    "LEGISLA√á√ÉO-ESPEC√çFICA.json"];
  const list = document.getElementById("simulados-list");
  nomes.forEach(n => {
    const li = document.createElement("li");
    li.innerHTML = `<a onclick="loadQuiz('${n}')">${n.replace(".json","")}</a>`;
    list.appendChild(li);
  });
}
window.onload = carregarLista;
</script>
</body>
</html>


